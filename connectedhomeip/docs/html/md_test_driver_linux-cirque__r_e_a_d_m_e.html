<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Connected Home over IP: The cirque testing suite</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Connected Home over IP
   &#160;<span id="projectnumber">672cf7684</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_test_driver_linux-cirque__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The cirque testing suite </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Cirque simulates complex network topologies based upon docker nodes. On a single Linux machine, it can create multiple nodes with network stacks that are independent from each other. Some nodes may be connected to simulated Thread networks, others may connect to simulated BLE or WiFi.</p>
<p>In Project CHIP, cirque is used for integration tests.</p>
<p>There is a script for running cirque tests, you can find it at <code>scripts/tests/cirque_tests.sh</code></p>
<h1><a class="anchor" id="autotoc_md86"></a>
Setting up cirque environment</h1>
<p>After checkout, in your local project chip directory, run:</p>
<div class="fragment"><div class="line">git submodule update --init</div>
<div class="line">scripts/tests/cirque_tests.sh bootstrap</div>
</div><!-- fragment --><p>It will:</p>
<ol type="1">
<li>Install necessary packages required by cirque,</li>
<li>Build <code>connectedhomeip/chip-cirque-device-base:latest</code> docker image for running devices,</li>
<li>Build openthread for simulating thread network.</li>
</ol>
<blockquote class="doxtable">
<p>Note: Suggest using a clean checkout before running this. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md87"></a>
Run tests</h1>
<p>You can run the tests by:</p>
<div class="fragment"><div class="line">scripts/tests/cirque_tests.sh run_all_tests</div>
</div><!-- fragment --><p>You can get more infomation from the terminal output (like the location of logs).</p>
<blockquote class="doxtable">
<p>Note: The container (as well as the networks) will be preserved for debugging. You may need to clean it by yourself. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md88"></a>
Run specific test</h1>
<p>You can run a single cirque test by:</p>
<div class="fragment"><div class="line">scripts/tests/cirque_tests.sh run_test &lt;test name&gt;</div>
</div><!-- fragment --><p>The test name is the script (<code>.sh</code>) file in <code>src/test_driver/linux-cirque</code>, like <code>OnOffClusterTest</code>.</p>
<p>For example, you can run <code>OnOffClusterTest</code> by:</p>
<div class="fragment"><div class="line">scripts/tests/cirque_tests.sh run_test OnOffClusterTest</div>
</div><!-- fragment --><p>The output of the test will be written to <code>stdout</code> and <code>stderr</code>.</p>
<h1><a class="anchor" id="autotoc_md89"></a>
Specify log directory</h1>
<p>To specify log directory, simplily set <code>LOG_DIR</code> variable.</p>
<div class="fragment"><div class="line">export LOG_DIR=/some/log/directory</div>
<div class="line">scripts/tests/cirque_tests.sh run_all_tests</div>
<div class="line">scripts/tests/cirque_tests.sh run_test OnOffClusterTest</div>
</div><!-- fragment --><p>Or</p>
<div class="fragment"><div class="line">LOG_DIR=/some/log/directory scripts/tests/cirque_tests.sh run_all_tests</div>
<div class="line">LOG_DIR=/some/log/directory scripts/tests/cirque_tests.sh run_test OnOffClusterTest</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md90"></a>
Setup test topology only</h1>
<p>You can run a ManualTest to setup test topology only:</p>
<div class="fragment"><div class="line">scripts/tests/cirque_tests.sh run_test ManualTest</div>
</div><!-- fragment --><p>It will print the container id in log, you can execute commands inside them.</p>
<div class="fragment"><div class="line">2021-04-06 15:01:57,780 [CHIPCirqueTest] INFO Finished setting up environment.</div>
<div class="line">2021-04-06 15:01:57,780 [CHIPCirqueTest] INFO Device: CHIP-Server (Type: CHIP-Server, Container: 459c901ed9)</div>
<div class="line">2021-04-06 15:01:57,780 [CHIPCirqueTest] INFO Device: CHIP-Tool (Type: CHIP-Tool, Container: c5831124e7)</div>
<div class="line">2021-04-06 15:01:57,780 [CHIPCirqueTest] INFO Press Ctrl-C to stop the test.</div>
<div class="line">2021-04-06 15:01:57,780 [CHIPCirqueTest] INFO Container will be cleaned when the test finished.</div>
</div><!-- fragment --><blockquote class="doxtable">
<p>You can run docker commands with these containers, for example, to launch a shell on CHIP-Tool, you can use:</p>
<div class="fragment"><div class="line">docker exec -it c5831124e7 /bin/bash</div>
</div><!-- fragment --><p>For detailed command you can use, please refer to <a href="https://docs.docker.com/engine/reference/commandline/cli/">official docker documents</a>. </p>
</blockquote>
<blockquote class="doxtable">
<p>It is not recommanded to run commands that can change the state of the container, for example: <code>attach</code> (will stop container once you exit), <code>stop</code> etc. </p>
</blockquote>
<p>After you finished you test, press <code>Ctrl-C</code> and it will clean up testing environment.</p>
<p>Refer to <code>test-manual.py</code> and <code>ManualTest.sh</code> for detail. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Apr 15 2021 18:57:05 for Connected Home over IP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
